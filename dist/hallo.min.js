/* Hallo 1.0.4 - rich text editor for jQuery UI
* by Henri Bergius and contributors. Available under the MIT license.
* See http://hallojs.org for more information
*/(function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++){if(t in this&&this[t]===e)return t}return-1};(function(e){return e.widget("IKS.hallo",{toolbar:null,bound:false,originalContent:"",previousContent:"",uuid:"",selection:null,_keepActivated:false,originalHref:null,options:{editable:true,plugins:{},toolbar:"halloToolbarContextual",parentElement:"body",buttonCssClass:null,toolbarCssClass:null,toolbarPositionAbove:false,toolbarOptions:{},placeholder:"",forceStructured:true,checkTouch:true,touchScreen:null},_create:function(){var t,n,r,i=this;this.id=this._generateUUID();if(this.options.checkTouch&&this.options.touchScreen===null){this.checkTouch()}r=this.options.plugins;for(n in r){t=r[n];if(!e.isPlainObject(t)){t={}}e.extend(t,{editable:this,uuid:this.id,buttonCssClass:this.options.buttonCssClass});e(this.element)[n](t)}this.element.one("halloactivated",function(){return i._prepareToolbar()});return this.originalContent=this.getContents()},_init:function(){if(this.options.editable){return this.enable()}else{return this.disable()}},destroy:function(){var t,n,r;this.disable();if(this.toolbar){this.toolbar.remove();this.element[this.options.toolbar]("destroy")}r=this.options.plugins;for(n in r){t=r[n];e(this.element)[n]("destroy")}return e.Widget.prototype.destroy.call(this)},disable:function(){var t=this;this.element.attr("contentEditable",false);this.element.off("focus",this._activated);this.element.off("blur",this._deactivated);this.element.off("keyup paste change",this._checkModified);this.element.off("keyup",this._keys);this.element.off("keyup mouseup",this._checkSelection);this.bound=false;e(this.element).removeClass("isModified");e(this.element).removeClass("inEditMode");this.element.parents("a").addBack().each(function(n,r){var i;i=e(r);if(!i.is("a")){return}if(!t.originalHref){return}return i.attr("href",t.originalHref)});return this._trigger("disabled",null)},enable:function(){var t=this;this.element.parents("a[href]").addBack().each(function(n,r){var i;i=e(r);if(!i.is("a[href]")){return}t.originalHref=i.attr("href");return i.removeAttr("href")});this.element.attr("contentEditable",true);if(!e.parseHTML(this.element.html())){this.element.html(this.options.placeholder);e(this.element).addClass("inPlaceholderMode");this.element.css({"min-width":this.element.innerWidth(),"min-height":this.element.innerHeight()})}if(!this.bound){this.element.on("focus",this,this._activated);this.element.on("blur",this,this._deactivated);this.element.on("keyup paste change",this,this._checkModified);this.element.on("keyup",this,this._keys);this.element.on("keyup mouseup",this,this._checkSelection);this.bound=true}if(this.options.forceStructured){this._forceStructured()}return this._trigger("enabled",null)},activate:function(){return this.element.focus()},containsSelection:function(){var e;e=this.getSelection();return this.element.has(e.startContainer).length>0},getSelection:function(){var e,t;t=rangy.getSelection();e=null;if(t.rangeCount>0){e=t.getRangeAt(0)}else{e=rangy.createRange()}return e},restoreSelection:function(e){var t;t=rangy.getSelection();return t.setSingleRange(e)},replaceSelection:function(e){var t,n,r,i,s;if(navigator.appName==="Microsoft Internet Explorer"){s=document.selection.createRange().text;n=document.selection.createRange();return n.pasteHTML(e(s))}else{i=window.getSelection();r=i.getRangeAt(0);t=document.createTextNode(e(r.extractContents()));r.insertNode(t);r.setStartAfter(t);i.removeAllRanges();return i.addRange(r)}},removeAllSelections:function(){if(navigator.appName==="Microsoft Internet Explorer"){return range.empty()}else{return window.getSelection().removeAllRanges()}},getPluginInstance:function(t){var n,r;for(r in e(this.element).data()){if(/plugin$/i.test(r)){n=e(this.element).data(r);if(n){return n}}}n=e(this.element).data("IKS-"+t);if(n){return n}n=e(this.element).data(t);if(n){return n}throw new Error("Plugin "+t+" not found")},getContents:function(){var t,n,r;for(r in this.options.plugins){n=this.getPluginInstance(r);if(!n){continue}t=n.cleanupContentClone;if(!e.isFunction(t)){continue}e(this.element)[r]("cleanupContentClone",this.element)}return this.element.html()},setContents:function(e){return this.element.html(e)},isModified:function(){if(!this.previousContent){this.previousContent=this.originalContent}return this.previousContent!==this.getContents()},setUnmodified:function(){e(this.element).removeClass("isModified");return this.previousContent=this.getContents()},setModified:function(){e(this.element).addClass("isModified");return this._trigger("modified",null,{editable:this,content:this.getContents()})},restoreOriginalContent:function(){return this.element.html(this.originalContent)},execute:function(e,t){if(document.execCommand(e,false,t)){return this.element.trigger("change")}},protectFocusFrom:function(e){var t=this;return e.on("mousedown",function(e){e.preventDefault();t._protectToolbarFocus=true;return setTimeout(function(){return t._protectToolbarFocus=false},300)})},keepActivated:function(e){this._keepActivated=e},_generateUUID:function(){var e;e=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return""+e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},_prepareToolbar:function(){var t,n,r,i,s;this.toolbar=e('<div class="hallotoolbar"></div>').hide();if(this.options.toolbarCssClass){this.toolbar.addClass(this.options.toolbarCssClass)}t={editable:this,parentElement:this.options.parentElement,toolbar:this.toolbar,positionAbove:this.options.toolbarPositionAbove};s=e.extend({},t,this.options.toolbarOptions);this.element[this.options.toolbar](s);for(r in this.options.plugins){n=this.getPluginInstance(r);if(!n){continue}i=n.populateToolbar;if(!e.isFunction(i)){continue}this.element[r]("populateToolbar",this.toolbar)}this.element[this.options.toolbar]("setPosition");return this.protectFocusFrom(this.toolbar)},changeToolbar:function(e,t,n){var r;if(n==null){n=false}r=this.options.toolbar;this.options.parentElement=e;if(t){this.options.toolbar=t}if(!this.toolbar){return}this.element[r]("destroy");this.toolbar.remove();this._prepareToolbar();if(n){return this.toolbar.hide()}},_checkModified:function(e){var t;t=e.data;if(t.isModified()){return t.setModified()}},_keys:function(e){var t,n;n=e.data;if(e.keyCode===27){t=n.getContents();n.restoreOriginalContent(e);n._trigger("restored",null,{editable:n,content:n.getContents(),thrown:t});return n.turnOff()}},_rangesEqual:function(e,t){if(e.startContainer!==t.startContainer){return false}if(e.startOffset!==t.startOffset){return false}if(e.endContainer!==t.endContainer){return false}if(e.endOffset!==t.endOffset){return false}return true},_checkSelection:function(e){var t;if(e.keyCode===27){return}t=e.data;return setTimeout(function(){var n;n=t.getSelection();if(t._isEmptySelection(n)||t._isEmptyRange(n)){if(t.selection){t.selection=null;t._trigger("unselected",null,{editable:t,originalEvent:e})}return}if(!t.selection||!t._rangesEqual(n,t.selection)){t.selection=n.cloneRange();return t._trigger("selected",null,{editable:t,selection:t.selection,ranges:[t.selection],originalEvent:e})}},0)},_isEmptySelection:function(e){if(e.type==="Caret"){return true}return false},_isEmptyRange:function(e){if(e.collapsed){return true}if(e.isCollapsed){if(typeof e.isCollapsed==="function"){return e.isCollapsed()}return e.isCollapsed}return false},turnOn:function(){if(this.getContents()===this.options.placeholder){this.setContents("")}e(this.element).removeClass("inPlaceholderMode");e(this.element).addClass("inEditMode");return this._trigger("activated",null,this)},turnOff:function(){e(this.element).removeClass("inEditMode");this._trigger("deactivated",null,this);if(!this.getContents()){e(this.element).addClass("inPlaceholderMode");return this.setContents(this.options.placeholder)}},_activated:function(e){return e.data.turnOn()},_deactivated:function(t){if(t.data._keepActivated){return}if(t.data._protectToolbarFocus!==true){return t.data.turnOff()}else{return setTimeout(function(){return e(t.data.element).focus()},300)}},_forceStructured:function(e){try{return document.execCommand("styleWithCSS",0,false)}catch(t){try{return document.execCommand("useCSS",0,true)}catch(t){try{return document.execCommand("styleWithCSS",false,false)}catch(t){}}}},checkTouch:function(){return this.options.touchScreen=!!("createTouch"in document)}})})(jQuery);(function(e){var t;t=null;if(this.VIE!==void 0){t=new VIE;t.use(new t.StanbolService)({proxyDisabled:true,url:"http://dev.iks-project.eu:8081"})}return e.widget("IKS.halloannotate",{options:{vie:t,editable:null,toolbar:null,uuid:"",select:function(){},decline:function(){},remove:function(){},buttonCssClass:null},_create:function(){var t,n,r;r=this;if(this.options.vie===void 0){throw new Error("The halloannotate plugin requires VIE");return}if(typeof this.element.annotate!=="function"){throw new Error("The halloannotate plugin requires annotate.js");return}this.state="off";this.instantiate();n=function(){var t;t=this;return e(t).halloannotate("turnOff")};t=this.options.editable.element;return t.on("hallodisabled",n)},populateToolbar:function(t){var n,r=this;n=e('<span class="'+this.widgetName+'"></span>');this.button=n.hallobutton({label:"Annotate",icon:"icon-tags",editable:this.options.editable,command:null,uuid:this.options.uuid,cssClass:this.options.buttonCssClass,queryState:false});n.on("change",function(e){if(r.state==="pending"){return}if(r.state==="off"){return r.turnOn()}return r.turnOff()});n.buttonset();return t.append(this.button)},cleanupContentClone:function(t){if(this.state==="on"){return t.find(".entity:not([about])").each(function(){return e(this).replaceWith(e(this).html())})}},instantiate:function(){var t;t=this;return this.options.editable.element.annotate({vie:this.options.vie,debug:false,showTooltip:true,select:this.options.select,remove:this.options.remove,success:this.options.success,error:this.options.error}).on("annotateselect",function(e,n){return t.options.editable.setModified()}).on("annotateremove",function(){return e.noop()})},turnPending:function(){this.state="pending";this.button.hallobutton("checked",false);return this.button.hallobutton("disable")},turnOn:function(){var e,t=this;this.turnPending();e=this;try{return this.options.editable.element.annotate("enable",function(e){if(!e){return}t.state="on";t.button.hallobutton("checked",true);return t.button.hallobutton("enable")})}catch(n){return alert(n)}},turnOff:function(){this.options.editable.element.annotate("disable");this.state="off";if(!this.button){return}this.button.attr("checked",false);this.button.find("label").removeClass("ui-state-clicked");return this.button.button("refresh")}})})(jQuery);(function(e){return e.widget("IKS.halloblacklist",{options:{tags:[]},_init:function(){if(this.options.tags.indexOf("br")!==-1){return this.element.on("keydown",function(e){if(e.originalEvent.keyCode===13){return e.preventDefault()}})}},cleanupContentClone:function(t){var n,r,i,s,o;s=this.options.tags;o=[];for(r=0,i=s.length;r<i;r++){n=s[r];o.push(e(n,t).remove())}return o}})})(jQuery);(function(e){return e.widget("IKS.halloblock",{options:{editable:null,toolbar:null,uuid:"",elements:["h1","h2","h3","p","pre","blockquote"],buttonCssClass:null},populateToolbar:function(t){var n,r,i;n=e('<span class="'+this.widgetName+'"></span>');r=""+this.options.uuid+"-"+this.widgetName+"-data";i=this._prepareDropdown(r);t.append(n);n.hallobuttonset();n.append(i);return n.append(this._prepareButton(i))},_prepareDropdown:function(t){var n,r,i,s,o,u,a,f=this;i=e('<div id="'+t+'"></div>');r=this.options.editable.element.get(0).tagName.toLowerCase();n=function(t){var n,i,s;n=e("<button class='blockselector'>          <"+t+' class="menu-item">'+t+"</"+t+">        </button>");if(r===t){n.addClass("selected")}if(r!=="div"){n.addClass("disabled")}n.on("click",function(){var e;e=t.toUpperCase();if(n.hasClass("disabled")){return}if(navigator.appName==="Microsoft Internet Explorer"){f.options.editable.execute("FormatBlock","<"+e+">");return}return f.options.editable.execute("formatBlock",e)});s=function(e){var r;r=document.queryCommandValue("formatBlock");if(r.toLowerCase()===t){n.addClass("selected");return}return n.removeClass("selected")};i="keyup paste change mouseup";f.options.editable.element.on(i,s);f.options.editable.element.on("halloenabled",function(){return f.options.editable.element.on(i,s)});f.options.editable.element.on("hallodisabled",function(){return f.options.editable.element.off(i,s)});return n};a=this.options.elements;for(o=0,u=a.length;o<u;o++){s=a[o];i.append(n(s))}return i},_prepareButton:function(t){var n;n=e("<span></span>");n.hallodropdownbutton({uuid:this.options.uuid,editable:this.options.editable,label:"block",icon:"icon-text-height",target:t,cssClass:this.options.buttonCssClass});return n}})})(jQuery);(function(e){var t;t="The hallocleanhtml plugin requires the selection save and    restore module from Rangy";return e.widget("IKS.hallocleanhtml",{_create:function(){var n,r=this;if(e.htmlClean===void 0){throw new Error("The hallocleanhtml plugin requires jQuery.htmlClean");return}n=this.element;return n.bind("paste",this,function(i){var s,o,u;if(rangy.saveSelection===void 0){throw new Error(t);return}u=i.data;u.options.editable.getSelection().deleteContents();o=rangy.saveSelection();s=n.html();n.html("");return setTimeout(function(){var t,i,a;i=n.html();t=e.htmlClean(i,r.options);n.html(s);rangy.restoreSelection(o);if(t!==""){try{return document.execCommand("insertHTML",false,t)}catch(f){a=u.options.editable.getSelection();return a.insertNode(a.createContextualFragment(t))}}},4)})}})})(jQuery);(function(e){return e.widget("BF.friendly-image-plugin",{options:{uuid:"",editable:null,search:null,searchUrl:null,upload:null,uploadUrl:null,context:null,token:null,dialogOpts:{autoOpen:false,width:500,height:400,title:"Insert Images",modal:false,resizable:false,draggable:true,dialogClass:"friendly-image-dialog",maxWidth:250,maxHeight:250}},toolbar:null,populateToolbar:function(t){var n,r,i,s,o=this;this.toolbar=t;s=this;i=function(){var t,n,r,i,u,a,f,l;f="Upload image";l='                    <form action="#" method="post" class="image-upload-form">                        <input type="file" style="display:none" multiple="" />                        <button class="browse">Browse</button>                        <button class="upload" style="display:none">Upload</button>                        <button class="reset" style="display:none">Reset</button>                    </form>                    <div>                        <ul class="image-upload-queue"></ul>                        <ul class="available-images group"></ul>                    </div>';o.$dialog=n=e("<div>").attr("id",""+o.options.uuid+"-friendly-image-dialog").html(l);r=n.find('input[type="file"]');i=n.find("ul.image-upload-queue");a=n.find("button.upload");a.click(function(t){var n,r;t.preventDefault();n=e("button.remove",i);n.hide();(r=function(t){var i,o,u,a,f=this;if(--t<0){s._refreshImages();return}i=e(n.get(t));o=i.siblings(".icon-spinner");u=i.data("file");o.show();a=new window.S3Upload({token:s.options.token,files:[u],s3_sign_put_url:s.options.uploadUrl,context:s.options.context,onProgress:function(e,t,n,r){var i;return i=e},onFinishS3Put:function(e,n){i.click();return r(t)},onError:function(e,t){}})})(n.length);return false});u=n.find("button.reset");u.click(function(n){n.preventDefault();e("button.remove",i).each(function(){e(this).click()});t.show();a.hide();u.hide();return false});t=n.find("button.browse");t.click(function(e){e.preventDefault();r.click();return false});n.on("click","ul.available-images img",function(e){s._insertImage(e.currentTarget.src)});r.bind("change",function(n){var r,s,o,f,l,c;f=n.target.files;u.click();i.hide();for(l=0,c=f.length;l<c;l++){o=f[l];r=e('<li>                                <span class="filename">'+o.name+'</span>                                <span class="filetype">('+(o.type||"n/a")+')</span>                                <button class="remove">Remove</button>                                <i class="icon-spinner icon-spin icon-large" style="display:none"></i>                            </li>');s=r.find("button");s.data("file",o);s.click(function(t){t.preventDefault();e(t.target).parent().remove();if(!i.children().length){u.click()}return false});i.append(r)}i.show();t.hide();a.show();u.show()});return n};n=function(t){var n,r;r=""+o.options.uuid+"-image-button";n=e("<span></span>");n.hallobutton({label:t.label||"Image",icon:"icon-camera",uuid:t.uuid,editable:o.options.editable,command:null,queryState:false});n.click(function(){if(s.dialog.dialog("isOpen")){s._closeDialog()}else{s.lastSelection=s.options.editable.getSelection();s._openDialog()}return false});return n};this.dialog=i();this.dialog.dialog(this.options.dialogOpts);this.dialog.on("dialogclose",function(){console.log("Close dialog");s.options.editable.element.focus();s.options.editable.keepActivated(false)});this.button=n({uuid:this.options.uuid,label:"Image"});r=this.button.hallobuttonset();r.append(this.button);t.append(r);this.toolbar=t;this.options.editable.element.on("hallodeactivated",function(e){return s._closeDialog()});jQuery(this.options.editable.element).delegate("img","click",function(e){return s._openDialog()})},_create:function(){},destroy:function(){},cleanupContentClone:function(e){},_insertImage:function(e){var t;t=this.options.editable;t.restoreSelection(this.lastSelection);document.execCommand("insertImage",null,e);t.element.trigger("change");t.removeAllSelections();this._closeDialog()},_refreshImages:function(){var t;t=this;if(this.isRefreshing){return}this.isRefreshing=true;return e.getJSON(this.options.searchUrl,function(e,n){var r,i,s,o,u;r=t.dialog.find("ul.available-images").hide().empty();u=e.items;for(s=0,o=u.length;s<o;s++){i=u[s];r.append('<li><img src="'+e.host+"/"+i+'" width="100" height="100"></img></li>')}r.show();t.isRefreshing=false})},_openDialog:function(){var t,n;n=this;t=e(this.options.editable.element);this.lastSelection=this.options.editable.getSelection();this.options.editable.keepActivated(true);this._refreshImages();n.dialog.dialog("open")},_closeDialog:function(){this.dialog.dialog("close")}})})(jQuery);(function(e){return jQuery.widget("BF.friendly-table-plugin",{options:{editable:null,uuid:"",defaultCols:4,defaultRows:5,dialogOpts:{title:"Table",buttonTitle:"Insert",buttonUpdateTitle:"Update",autoOpen:false,width:560,height:"auto",modal:false,resizable:true,draggable:true,dialogClass:"insert-table-dialog"}},dialog:null,toolbar:null,button:null,populateToolbar:function(t){var n,r,i,s,o=this;s=this;i=function(){var t,n,r,i;n=o.options.dialogOpts.buttonTitle;r=o.options.dialogOpts.buttonUpdateTitle;i='						<form action="#" method="post" class="tableForm">							<label for="cols">Anzahl Spalten</label>							<input class="cols" type="text" name="cols"							       value="'+o.options.defaultCols+'" /><br/>							<label for="row">Anzahl Zeilen</label>							<input class="rows" type="text" name="rows"							       value="'+o.options.defaultRows+'" /><br/>							<label for="">Erste Zeile als Kopfzeile</label>							<input class="rows" type="checkbox" name="header"							       checked="checked" /><br/>							<input type="submit" id="addTableButton" 							       value="'+n+'"/>						</form>';t=e("<div>").attr("id",""+o.options.uuid+"-dialog").html(i);return t};r=jQuery('<span class="'+s.widgetName+'"></span>');n=function(t){var n,r;r=""+o.options.uuid+"-"+t;n=e("<span></span>");n.hallobutton({label:"Video",icon:"icon-table",uuid:o.options.uuid,editable:o.options.editable,command:null,queryState:false,cssClass:o.options.buttonCssClass});n.click(function(){console.log("Click");if(s.dialog.dialog("isOpen")){s._closeDialog()}else{s.lastSelection=s.options.editable.getSelection();s._openDialog()}return false});return n};this.dialog=i();this.dialog.dialog(this.options.dialogOpts);this.dialog.find("input[type=submit]").click(function(t){var n,r;t.preventDefault();n=e('input[name="cols"]',t.target.parentNode).val();r=e('input[name="rows"]',t.target.parentNode).val();o._insertTable(n,r,true);return false});this.dialog.on("dialogclose",function(){var t,n,r;t=e(document);n=o.options.editable;r=t.scrollTop();n.element.focus();t.scrollTop(r);n.keepActivated(false)});this.button=n("Table");r.append(this.button);t.append(r);this.toolbar=t},_openDialog:function(t){var n,r,i;r=e(t);i=this;n=e(this.options.editable.element);this.options.editable.keepActivated(true);this.dialog.dialog("open")},_closeDialog:function(){this.dialog.dialog("close")},_insertTable:function(e,t,n){var r,i,s,o,u,a;r=function(){var t,n;n=[];for(u=t=1;1<=e?t<=e:t>=e;u=1<=e?++t:--t){n.push("<td></td>")}return n}();a=function(){var e,n;n=[];for(u=e=1;1<=t?e<=t:e>=t;u=1<=t?++e:--e){n.push("<tr>"+r.join("")+"</tr>")}return n}();if(true===n){s=function(){var t,n;n=[];for(u=t=1;1<=e?t<=e:t>=e;u=1<=e?++t:--t){n.push("<th></th>")}return n}();s="<thead>"+s.join("")+"</thead>"}o="<table>"+s+"<tbody>"+a.join("")+"</tbody></table>";i=this.options.editable;i.restoreSelection(this.lastSelection);document.execCommand("insertHTML",null,o);i.element.trigger("change");i.removeAllSelections();this._closeDialog()}})})(jQuery);(function(t){var n;n=function(){function t(n,r){var i;this.id=n;this.provider=r;if(i=!this.provider,e.call(t.PROVIDERS,i)>=0){throw new Error}}t.UNSUPPORTED="unsupported";t.YOUTUBE="youtube";t.VIMEO="vimeo";t.PROVIDERS=[t.YOUTUBE,t.VIMEO];t.prototype.generateUrl=function(e,n){var r;r=null;switch(this.provider){case t.YOUTUBE:r="//www.youtube.com/embed/"+e;break;case t.VIMEO:r="//player.vimeo.com/video/"+e}return r};t.prototype.generateThumbnailUrl=function(e,n){var r;r=null;switch(this.provider){case t.YOUTUBE:r="//img.youtube.com/vi/"+e+"/0.jpg"}return r};t.prototype.getThumbnailCode=function(){var e,n;e=null;n=this.generateThumbnailUrl(this.id,this.provider);switch(this.provider){case t.YOUTUBE:e='<img src="'+n+'" data-video="'+this.provider+"--"+this.id+'" />'}return e};t.prototype.getEmbedCode=function(){var e,n;e=null;n=this.generateUrl(this.id,this.provider);switch(this.provider){case t.YOUTUBE:e='<iframe data-video="'+this.provider+"--"+this.id+'" src="'+n+'" width="560" height="315" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>';break;case t.VIMEO:e='<iframe data-video="'+this.provider+"--"+this.id+'" src="'+n+'" width="560" height="315" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'}return e};t.getId=function(e){var n,r,i,s,o;n=-1;r=null;if(e.indexOf("://")!==-1){if(e.indexOf("//")!==-1){e=e.slice(e.indexOf("//"))}if(e.indexOf("youtube.com")!==-1){r=t.YOUTUBE;s=/^\/\/www.youtube.com\/watch\?v=([\w\d\_\-]+)$/i.exec(e),i=s[0],n=s[1]}else if(e.indexOf("vimeo.com")!==-1){r=t.VIMEO;o=/^\/\/vimeo.com\/([\w\d\_]+)$/i.exec(e),i=o[0],n=o[1]}else{r=t.UNSUPPORTED}}else{r=t.YOUTUBE;n=e}return[n,r]};t.from=function(e){var n,r,i;i=t.getId(e),n=i[0],r=i[1];return new t(n,r)};return t}();return jQuery.widget("BF.friendly-video-plugin",{options:{editable:null,uuid:"",defaultUrl:"pqAsIm9_Eg4",usePlaceholder:false,dialogOpts:{title:"YouTube Video",buttonTitle:"Insert",buttonUpdateTitle:"Update",autoOpen:false,width:340,height:"auto",modal:false,resizable:true,draggable:true,dialogClass:"insert-image-dialog"}},dialog:null,toolbar:null,button:null,currentEditable:null,_create:function(){var e=this;return this.element.on("halloenabled",function(){})},populateToolbar:function(e){var r,i,s,o,u=this;o=this;s=function(){var e,n,r,i;n=u.options.dialogOpts.buttonTitle;r=u.options.dialogOpts.buttonUpdateTitle;i='						<form action="#" method="post" class="videoForm">							<input class="url" type="text" name="url"							       value="'+u.options.defaultUrl+'" />							<input type="submit" id="addVideoButton" 							       value="'+n+'"/>						</form>';e=t("<div>").attr("id",""+u.options.uuid+"-video-dialog").html(i);return e};i=jQuery('<span class="'+o.widgetName+'"></span>');r=function(e){var n,r;r=""+u.options.uuid+"-"+e;n=t("<span></span>");n.hallobutton({label:"Video",icon:"icon-film",uuid:u.options.uuid,editable:u.options.editable,command:null,queryState:false,cssClass:u.options.buttonCssClass});n.click(function(){console.log("Click");if(o.dialog.dialog("isOpen")){o._closeDialog()}else{o.lastSelection=o.options.editable.getSelection();o._openDialog()}return false});return n};this.options.editable.element.on("hallodeactivated",function(e,r){var i;if(u.options.usePlaceholder){i=t("img[data-video]",e.target);i.each(function(){var e,r,i,s,o;e=t(this);r=e.data("video").split("--");o=r[0],s=r[1];i=new n(s,o);e.replaceWith(i.getEmbedCode())})}o.currentEditable=t(e.target)});this.options.editable.element.on("halloactivated",function(e,r){var i;if(u.options.usePlaceholder){i=t("iframe[data-video]",e.target);i.each(function(){var e,r,i,s,o;e=t(this);r=e.data("video").split("--");o=r[0],s=r[1];i=new n(s,o);e.replaceWith(i.getThumbnailCode())})}});this.dialog=s();this.dialog.dialog(this.options.dialogOpts);this.dialog.find("input[type=submit]").click(function(e){e.preventDefault();u._insertVideo(t('input[name="url"]',e.target.parentNode).val());return false});this.dialog.on("dialogclose",function(){var e,n,r;e=t(document);n=u.options.editable;r=e.scrollTop();n.element.focus();e.scrollTop(r);n.keepActivated(false)});this.button=r("Video");i.append(this.button);e.append(i);this.toolbar=e},_openDialog:function(e){var n,r,i;r=t(e);i=this;n=t(this.options.editable.element);this.options.editable.keepActivated(true);this.dialog.dialog("open")},_closeDialog:function(){this.dialog.dialog("close")},_insertVideo:function(e){var t,r,i;r=n.from(e);i=this.options.usePlaceholder?r.getThumbnailCode():r.getEmbedCode();t=this.options.editable;t.restoreSelection(this.lastSelection);document.execCommand("insertHTML",null,i);t.element.trigger("change");t.removeAllSelections();this._closeDialog()}})})(jQuery);(function(e){return e.widget("IKS.halloformat",{options:{editable:null,uuid:"",formattings:{bold:true,italic:true,strikeThrough:false,underline:false},buttonCssClass:null},populateToolbar:function(t){var n,r,i,s,o,u,a=this;o=this;r=e('<span class="'+o.widgetName+'"></span>');n=function(t){var n;n=e("<span></span>");n.hallobutton({label:t,editable:a.options.editable,command:t,uuid:a.options.uuid,cssClass:a.options.buttonCssClass});return r.append(n)};u=this.options.formattings;for(s in u){i=u[s];if(!i){continue}n(s)}r.hallobuttonset();return t.append(r)}})})(jQuery);(function(e){return e.widget("IKS.halloheadings",{options:{editable:null,uuid:"",formatBlocks:["p","h1","h2","h3"],buttonCssClass:null},populateToolbar:function(t){var n,r,i,s,o,u,a,f,l,c=this;u=this;r=e('<span class="'+u.widgetName+'"></span>');o=navigator.appName==="Microsoft Internet Explorer";i=o?"FormatBlock":"formatBlock";n=function(t){var n;n=e("<span></span>");n.hallobutton({label:t,editable:c.options.editable,command:i,commandValue:o?"<"+t+">":t,uuid:c.options.uuid,cssClass:c.options.buttonCssClass,queryState:function(e){var r,s,u,a,f,l,c,h;try{f=document.queryCommandValue(i);if(o){s={p:"normal"};h=[1,2,3,4,5,6];for(l=0,c=h.length;l<c;l++){a=h[l];s["h"+a]=a}r=f.match(new RegExp(s[t],"i"))}else{r=f.match(new RegExp(t,"i"))}u=r?true:false;return n.hallobutton("checked",u)}catch(p){}}});n.find("button .ui-button-text").text(t.toUpperCase());return r.append(n)};l=this.options.formatBlocks;for(a=0,f=l.length;a<f;a++){s=l[a];n(s)}r.hallobuttonset();return t.append(r)}})})(jQuery);(function(e){return e.widget("IKS.hallohtml",{options:{editable:null,toolbar:null,uuid:"",lang:"en",dialogOpts:{autoOpen:false,width:600,height:"auto",modal:false,resizable:true,draggable:true,dialogClass:"htmledit-dialog"},dialog:null,buttonCssClass:null},translations:{en:{title:"Edit HTML",update:"Update"},de:{title:"HTML bearbeiten",update:"Aktualisieren"}},texts:null,populateToolbar:function(t){var n,r,i,s,o;o=this;this.texts=this.translations[this.options.lang];this.options.toolbar=t;s=""+this.options.uuid+"-htmledit-dialog";this.options.dialog=e("<div>").attr("id",s);r=e("<span>").addClass(o.widgetName);i=""+this.options.uuid+"-htmledit";n=e("<span>");n.hallobutton({label:this.texts.title,icon:"icon-list-alt",editable:this.options.editable,command:null,queryState:false,uuid:this.options.uuid,cssClass:this.options.buttonCssClass});r.append(n);this.button=n;this.button.click(function(){if(o.options.dialog.dialog("isOpen")){o._closeDialog()}else{o._openDialog()}return false});this.options.editable.element.on("hallodeactivated",function(){return o._closeDialog()});t.append(r);this.options.dialog.dialog(this.options.dialogOpts);return this.options.dialog.dialog("option","title",this.texts.title)},_openDialog:function(){var t,n,r,i,s,o=this;r=this;t=e(this.options.editable.element);i=t.offset().left+t.outerWidth()+10;s=this.options.toolbar.offset().top-e(document).scrollTop();this.options.dialog.dialog("option","position",[i,s]);this.options.editable.keepActivated(true);this.options.dialog.dialog("open");this.options.dialog.on("dialogclose",function(){e("label",o.button).removeClass("ui-state-active");o.options.editable.element.focus();return o.options.editable.keepActivated(false)});this.options.dialog.html(e("<textarea>").addClass("html_source"));n=this.options.editable.element.html();this.options.dialog.children(".html_source").val(n);this.options.dialog.prepend(e("<button>"+this.texts.update+"</button>"));return this.options.dialog.on("click","button",function(){n=r.options.dialog.children(".html_source").val();r.options.editable.element.html(n);r.options.editable.element.trigger("change");return false})},_closeDialog:function(){return this.options.dialog.dialog("close")}})})(jQuery);(function(e){return e.widget("IKS.halloimagecurrent",{options:{imageWidget:null,startPlace:"",draggables:[],maxWidth:400,maxHeight:200},_create:function(){this.element.html('<div>        <div class="activeImageContainer">          <div class="rotationWrapper">            <div class="hintArrow"></div>              <img src="" class="activeImage" />            </div>            <img src="" class="activeImage activeImageBg" />          </div>        </div>');this.element.hide();return this._prepareDnD()},_init:function(){var t,n;t=e(this.options.editable.element);n=this;e("img",t).each(function(e,r){return n._initDraggable(r,t)});return e("p",t).each(function(t,r){if(e(r).data("jquery_droppable_initialized")){return}e(r).droppable({tolerance:"pointer",drop:function(e,t){return n._handleDropEvent(e,t)},over:function(e,t){return n._handleOverEvent(e,t)},out:function(e,t){return n._handleLeaveEvent(e,t)}});return e(r).data("jquery_droppable_initialized",true)})},_prepareDnD:function(){var t,n,r;r=this;t=e(this.options.editable.element);this.options.offset=t.offset();this.options.third=parseFloat(t.width()/3);n={width:this.options.third,height:t.height()};this.overlay={big:e("<div/>").addClass("bigOverlay").css({width:this.options.third*2,height:t.height()}),left:e("<div/>").addClass("smallOverlay smallOverlayLeft"),right:e("<div/>").addClass("smallOverlay smallOverlayRight")};this.overlay.left.css(n);this.overlay.right.css(n).css("left",this.options.third*2);t.on("halloactivated",function(){return r._enableDragging()});return t.on("hallodeactivated",function(){return r._disableDragging()})},setImage:function(t){if(!t){return}this.element.show();e(".activeImage",this.element).attr("src",t.url);if(t.label){e("input",this.element).val(t.label)}return this._initImage(e(this.options.editable.element))},_delayAction:function(e,t){var n;n=clearTimeout(n);if(!n){return n=setTimeout(e,t)}},_calcDropPosition:function(e,t){var n,r;n=e.left+this.options.third;r=e.left+this.options.third*2;if(t.pageX>=n&&t.pageX<=r){return"middle"}else if(t.pageX<n){return"left"}else if(t.pageX>r){return"right"}},_createInsertElement:function(t,n){var r,i;r=e("<img>");i=new Image;e(i).on("load",function(){});i.src=t.src;r.attr({src:i.src,alt:!n?e(t).attr("alt"):void 0,"class":n?"halloTmp":"imageInText"});r.show();return r},_createLineFeedbackElement:function(){return e("<div/>").addClass("halloTmpLine")},_removeFeedbackElements:function(){this.overlay.big.remove();this.overlay.left.remove();this.overlay.right.remove();return e(".halloTmp, .halloTmpLine",this.options.editable.element).remove()},_removeCustomHelper:function(){return e(".customHelper").remove()},_showOverlay:function(t){var n,r;r=e(this.options.editable.element);n=r.height();n+=parseFloat(r.css("paddingTop"));n+=parseFloat(r.css("paddingBottom"));this.overlay.big.css({height:n});this.overlay.left.css({height:n});this.overlay.right.css({height:n});switch(t){case"left":this.overlay.big.addClass("bigOverlayLeft");this.overlay.big.removeClass("bigOverlayRight");this.overlay.big.css({left:this.options.third});this.overlay.big.show();this.overlay.left.hide();return this.overlay.right.hide();case"middle":this.overlay.big.removeClass("bigOverlayLeft bigOverlayRight");this.overlay.big.hide();this.overlay.left.show();return this.overlay.right.show();case"right":this.overlay.big.addClass("bigOverlayRight");this.overlay.big.removeClass("bigOverlayLeft");this.overlay.big.css({left:0});this.overlay.big.show();this.overlay.left.hide();return this.overlay.right.hide()}},_checkOrigin:function(t){if(e(t.target).parents("[contenteditable]").length!==0){return true}return false},_createFeedback:function(e,t){var n;if(t==="middle"){return this._createLineFeedbackElement()}n=this._createInsertElement(e,true);return n.addClass("inlineImage-"+t)},_handleOverEvent:function(t,n){var r,i,s;s=this;r=e(this.options.editable);i=function(){var i,o;window.waitWithTrash=clearTimeout(window.waitWithTrash);i=s._calcDropPosition(s.options.offset,t);e(".trashcan",n.helper).remove();r[0].element.append(s.overlay.big);r[0].element.append(s.overlay.left);r[0].element.append(s.overlay.right);s._removeFeedbackElements();o=e(t.target);o.prepend(s._createFeedback(n.draggable[0],i));if(i==="middle"){o.prepend(s._createFeedback(n.draggable[0],"right"));e(".halloTmp",t.target).hide()}else{o.prepend(s._createFeedback(n.draggable[0],"middle"));e(".halloTmpLine",t.target).hide()}return s._showOverlay(i)};return setTimeout(i,5)},_handleDragEvent:function(t,n){var r,i,s;r=this._calcDropPosition(this.options.offset,t);if(r===this._lastPositionDrag){return}this._lastPositionDrag=r;i=e(".halloTmp",this.options.editable.element);s=e(".halloTmpLine",this.options.editable.element);if(r==="middle"){s.show();i.hide()}else{s.hide();i.removeClass("inlineImage-left inlineImage-right");i.addClass("inlineImage-"+r);i.show()}return this._showOverlay(r)},_handleLeaveEvent:function(t,n){var r;r=function(){if(!e("div.trashcan",n.helper).length){e(n.helper).append(e('<div class="trashcan"></div>'));return e(".bigOverlay, .smallOverlay").remove()}};window.waitWithTrash=setTimeout(r,200);return this._removeFeedbackElements()},_handleStartEvent:function(t,n){var r;r=this._checkOrigin(t);if(r){e(t.target).remove()}e(document).trigger("startPreventSave");return this.options.startPlace=e(t.target)},_handleStopEvent:function(t,n){var r;r=this._checkOrigin(t);if(r){e(t.target).remove()}else{e(this.options.editable.element).trigger("change")}this.overlay.big.hide();this.overlay.left.hide();this.overlay.right.hide();return e(document).trigger("stopPreventSave")},_handleDropEvent:function(t,n){var r,i,s,o,u,a;i=e(this.options.editable.element);o=this._checkOrigin(t);a=this._calcDropPosition(this.options.offset,t);this._removeFeedbackElements();this._removeCustomHelper();s=this._createInsertElement(n.draggable[0],false);r="inlineImage-middle inlineImage-left inlineImage-right";if(a==="middle"){s.show();s.removeClass(r);u=i.width();u+=parseFloat(i.css("paddingLeft"));u+=parseFloat(i.css("paddingRight"));u-=s.attr("width");s.addClass("inlineImage-"+a).css({position:"relative",left:u/2});s.insertBefore(e(t.target))}else{s.removeClass(r);s.addClass("inlineImage-"+a);s.css("display","block");e(t.target).prepend(s)}this.overlay.big.hide();this.overlay.left.hide();this.overlay.right.hide();i.trigger("change");return this._initImage(i)},_createHelper:function(t){return e("<div>").css({backgroundImage:"url("+e(t.currentTarget).attr("src")+")"}).addClass("customHelper").appendTo("body")},_initDraggable:function(t,n){var r;r=this;if(!t.jquery_draggable_initialized){t.jquery_draggable_initialized=true;e(t).draggable({cursor:"move",helper:function(e){return r._createHelper(e)},drag:function(e,t){return r._handleDragEvent(e,t)},start:function(e,t){return r._handleStartEvent(e,t)},stop:function(e,t){return r._handleStopEvent(e,t)},disabled:!n.hasClass("inEditMode"),cursorAt:{top:50,left:50}})}return r.options.draggables.push(t)},_initImage:function(t){var n;n=this;return e(".rotationWrapper img",this.options.dialog).each(function(e,r){return n._initDraggable(r,t)})},_enableDragging:function(){return e.each(this.options.draggables,function(t,n){return e(n).draggable("option","disabled",false)})},_disableDragging:function(){return e.each(this.options.draggables,function(t,n){return e(n).draggable("option","disabled",true)})}})})(jQuery);(function(e){return e.widget("IKS.halloimagesearch",{options:{imageWidget:null,searchCallback:null,searchUrl:null,limit:5},_create:function(){return this.element.html('<div>        <form method="get">          <input type="text" class="searchInput" placeholder="Search" />          <input type="submit" class="btn searchButton" value="OK" />        </form>        <div class="searchResults imageThumbnailContainer">          <div class="activitySpinner">Loading images...</div>          <ul></ul>        </div>      </div>')},_init:function(){var t=this;if(this.options.searchUrl&&!this.options.searchCallback){this.options.searchCallback=this._ajaxSearch}e(".activitySpinner",this.element).hide();return e("form",this.element).submit(function(n){var r;n.preventDefault();e(".activitySpinner",t.element).show();r=e(".searchInput",t.element.element).val();return t.options.searchCallback(r,t.options.limit,0,function(e){return t._showResults(e)})})},_showResult:function(t){var n,r=this;if(!t.label){t.label=t.alt}n=e('<li>        <img src="'+t.url+'" class="imageThumbnail"          title="'+t.label+'"></li>');n.on("click",function(){return r.options.imageWidget.setCurrent(t)});e("img",n).on("mousedown",function(e){e.preventDefault();return r.options.imageWidget.setCurrent(t)});return e(".imageThumbnailContainer ul",this.element).append(n)},_showNextPrev:function(t){var n,r=this;n=e("imageThumbnailContainer ul",this.element);n.prepend(e('<div class="pager-prev" style="display:none" />'));n.append(e('<div class="pager-next" style="display:none" />'));if(t.offset>0){e(".pager-prev",n).show()}if(t.offset<t.total){e(".pager-next",n).show()}e(".pager-prev",n).click(function(e){var n;n=t.offset-r.options.limit;return r.options.searchCallback(query,r.options.limit,n,function(e){return r._showResults(e)})});return e(".pager-next",n).click(function(e){var n;n=t.offset+r.options.limit;return r.options.searchCallback(query,r.options.limit,n,function(e){return r._showResults(e)})})},_showResults:function(t){var n,r,i,s;e(".activitySpinner",this.element).hide();e(".imageThumbnailContainer ul",this.element).empty();e(".imageThumbnailContainer ul",this.element).show();s=t.assets;for(r=0,i=s.length;r<i;r++){n=s[r];this._showResult(n)}this.options.imageWidget.setCurrent(t.assets.shift());return this._showNextPrev(t)},_ajaxSearch:function(t,n,r,i){var s;s=this.searchUrl+"?"+e.param({q:t,limit:n,offset:r});return e.getJSON(s,i)}})})(jQuery);(function(e){return e.widget("IKS.halloimagesuggestions",{loaded:false,options:{entity:null,vie:null,dbPediaUrl:null,getSuggestions:null,thumbnailUri:"<http://dbpedia.org/ontology/thumbnail>"},_create:function(){return this.element.html('      <div id="'+this.options.uuid+'-tab-suggestions">        <div class="imageThumbnailContainer">          <div class="activitySpinner">Loading images...</div>          <ul></ul>        </div>      </div>')},_init:function(){return e(".activitySpinner",this.element).hide()},_normalizeRelated:function(e){if(_.isString(e)){return e}if(_.isArray(e)){return e.join(",")}return e.pluck("@subject").join(",")},_prepareVIE:function(){if(!this.options.vie){this.options.vie=new VIE}if(this.options.vie.services.dbpedia){return}if(!this.options.dbPediaUrl){return}return this.options.vie.use(new vie.DBPediaService)({url:this.options.dbPediaUrl,proxyDisabled:true})},_getSuggestions:function(){var t,n,r;if(this.loaded){return}if(!this.options.entity){return}e(".activitySpinner",this.element).show();r=this.options.entity.get("skos:related");if(r.length===0){e("#activitySpinner").html("No images found.");return}e(".imageThumbnailContainer ul",this.element).empty();n=this._normalizeRelated(r);t=this.options.limit;if(this.options.getSuggestions){this.options.getSuggestions(n,t,0,this._showSuggestions)}this._prepareVIE();if(this.options.vie.services.dbpedia){this._getSuggestionsDbPedia(r)}return this.loaded=true},_getSuggestionsDbPedia:function(t){var n,r;r=this;n=1;return _.each(t,function(t){return vie.load({entity:t}).using("dbpedia").execute().done(function(n){e(".activitySpinner",this.element).hide();return _.each(n,function(e){var n,i;i=e.attributes[r.options.thumbnailUri];if(!i){return}if(_.isObject(i)){n=i[0].value}if(_.isString(i)){n=r.options.entity.fromReference(i)}return r._showSuggestion({url:n,label:t})})})})},_showSuggestion:function(t){var n,r=this;n=e('<li>        <img src="'+t.url+'" class="imageThumbnail"          title="'+t.label+'">        </li>');n.on("click",function(){return r.options.imageWidget.setCurrent(t)});return e(".imageThumbnailContainer ul",this.element).append(n)},_showSuggestions:function(t){var n=this;e(".activitySpinner",this.element).hide();return _.each(t,function(e){return n._showSuggestion(e)})}})})(jQuery);(function(e){return e.widget("IKS.halloimageupload",{options:{uploadCallback:null,uploadUrl:null,imageWidget:null,entity:null},_create:function(){return this.element.html('        <form class="upload">        <input type="file" class="file" name="userfile" accept="image/*" />        <input type="hidden" name="tags" value="" />        <input type="text" class="caption" name="caption" placeholder="Title" />        <button class="uploadSubmit">Upload</button>        </form>      ')},_init:function(){var t;t=this;if(t.options.uploadUrl&&!t.options.uploadCallback){t.options.uploadCallback=t._iframeUpload}return e(".uploadSubmit",this.element).on("click",function(e){e.preventDefault();e.stopPropagation();return t.options.uploadCallback({widget:t,success:function(e){return t.options.imageWidget.setCurrent({url:e,label:""})}})})},_prepareIframe:function(t){var n,r;r=""+t.widgetName+"_postframe_"+t.options.uuid;r=r.replace(/-/g,"_");n=e("#"+r);if(n.length){return n}n=e('<iframe name="'+r+'" id="'+r+'"        class="hidden" style="display:none" />');this.element.append(n);n.get(0).name=r;return n},_iframeUpload:function(t){var n,r,i,s;s=t.widget;n=s._prepareIframe(s);r=e("form.upload",s.element);if(typeof s.options.uploadUrl==="function"){i=s.options.uploadUrl(s.options.entity)}else{i=s.options.uploadUrl}n.on("load",function(){var e;e=n.get(0).contentWindow.location.href;s.element.hide();return t.success(e)});r.attr("action",i);r.attr("method","post");r.attr("target",n.get(0).name);r.attr("enctype","multipart/form-data");r.attr("encoding","multipart/form-data");return r.submit()}})})(jQuery);(function(e){return e.widget("IKS.halloimage",{options:{editable:null,toolbar:null,uuid:"",limit:8,search:null,searchUrl:null,suggestions:null,loaded:null,upload:null,uploadUrl:null,dialogOpts:{autoOpen:false,width:270,height:"auto",title:"Insert Images",modal:false,resizable:false,draggable:true,dialogClass:"halloimage-dialog"},dialog:null,buttonCssClass:null,entity:null,vie:null,dbPediaUrl:"http://dev.iks-project.eu/stanbolfull",maxWidth:250,maxHeight:250},populateToolbar:function(t){var n,r,i,s,o,u,a;this.options.toolbar=t;a=this;i=""+this.options.uuid+"-image-dialog";this.options.dialog=e('<div id="'+i+'">        <div class="nav">          <ul class="tabs">          </ul>          <div id="'+this.options.uuid+'-tab-activeIndicator"            class="tab-activeIndicator" />        </div>        <div class="dialogcontent">        </div>');u=e(".tabs",this.options.dialog);o=e(".dialogcontent",this.options.dialog);if(a.options.suggestions){this._addGuiTabSuggestions(u,o)}if(a.options.search||a.options.searchUrl){this._addGuiTabSearch(u,o)}if(a.options.upload||a.options.uploadUrl){this._addGuiTabUpload(u,o)}this.current=e('<div class="currentImage"></div>').halloimagecurrent({uuid:this.options.uuid,imageWidget:this,editable:this.options.editable,dialog:this.options.dialog,maxWidth:this.options.maxWidth,maxHeight:this.options.maxHeight});e(".dialogcontent",this.options.dialog).append(this.current);r=e('<span class="'+a.widgetName+'"></span>');s=""+this.options.uuid+"-image";n=e("<span></span>");n.hallobutton({label:"Images",icon:"icon-picture",editable:this.options.editable,command:null,queryState:false,uuid:this.options.uuid,cssClass:this.options.buttonCssClass});r.append(n);this.button=n;this.button.on("click",function(e){if(a.options.dialog.dialog("isOpen")){a._closeDialog()}else{a._openDialog()}return false});this.options.editable.element.on("hallodeactivated",function(e){return a._closeDialog()});e(this.options.editable.element).delegate("img","click",function(e){return a._openDialog()});t.append(r);this.options.dialog.dialog(this.options.dialogOpts);return this._handleTabs()},setCurrent:function(e){return this.current.halloimagecurrent("setImage",e)},_handleTabs:function(){var t;t=this;e(".nav li",this.options.dialog).on("click",function(){var n,r;e("."+t.widgetName+"-tab").hide();n=e(this).attr("id");e("#"+n+"-content").show();r=e(this).position().left+e(this).width()/2;return e("#"+t.options.uuid+"-tab-activeIndicator").css({"margin-left":r})});return e(".nav li",this.options.dialog).first().click()},_openDialog:function(){var t,n,r,i,s,o,u,a,f=this;o=this;t=function(){return window.setTimeout(function(){var t;t=e(".imageThumbnail");return e(t).each(function(){var t;t=e("#"+this.id).width();if(t<=20){return e("#"+this.id).parent("li").remove()}})},15e3)};i="#"+this.options.uuid+"-tab-suggestions-content";r=function(){return e(".imageThumbnailActive",i).first().attr("src")};e("#"+this.options.uuid+"-sugg-activeImage").attr("src",r());e("#"+this.options.uuid+"-sugg-activeImageBg").attr("src",r());this.lastSelection=this.options.editable.getSelection();n=e(this.options.editable.element);s=e(this.options.toolbar);u=n.offset().left+n.outerWidth()-3;a=s.offset().top+s.outerHeight()+29;a-=e(document).scrollTop();this.options.dialog.dialog("option","position",[u,a]);t();o.options.loaded=1;this.options.editable.keepActivated(true);this.options.dialog.dialog("open");return this.options.dialog.on("dialogclose",function(){e("label",f.button).removeClass("ui-state-active");f.options.editable.element.focus();return f.options.editable.keepActivated(false)})},_closeDialog:function(){return this.options.dialog.dialog("close")},_addGuiTabSuggestions:function(t,n){var r;t.append(e('<li id="'+this.options.uuid+'-tab-suggestions"        class="'+this.widgetName+"-tabselector "+this.widgetName+'-tab-suggestions">          <span>Suggestions</span>        </li>'));r=e('<div id="'+this.options.uuid+'-tab-suggestions-content"        class="'+this.widgetName+'-tab tab-suggestions"></div>');n.append(r);return r.halloimagesuggestions({uuid:this.options.uuid,imageWidget:this,entity:this.options.entity})},_addGuiTabSearch:function(t,n){var r,i,s;s=this;r=""+this.options.uuid+"-image-dialog";t.append(e('<li id="'+this.options.uuid+'-tab-search"        class="'+this.widgetName+"-tabselector "+this.widgetName+'-tab-search">          <span>Search</span>        </li>'));i=e('<div id="'+this.options.uuid+'-tab-search-content"        class="'+s.widgetName+'-tab tab-search"></div>');n.append(i);return i.halloimagesearch({uuid:this.options.uuid,imageWidget:this,searchCallback:this.options.search,searchUrl:this.options.searchUrl,limit:this.options.limit,entity:this.options.entity})},_addGuiTabUpload:function(t,n){var r;t.append(e('<li id="'+this.options.uuid+'-tab-upload"        class="'+this.widgetName+"-tabselector "+this.widgetName+'-tab-upload">          <span>Upload</span>        </li>'));r=e('<div id="'+this.options.uuid+'-tab-upload-content"        class="'+this.widgetName+'-tab tab-upload"></div>');n.append(r);return r.halloimageupload({uuid:this.options.uuid,uploadCallback:this.options.upload,uploadUrl:this.options.uploadUrl,imageWidget:this,entity:this.options.entity})}})})(jQuery);(function(e){return e.widget("IKS.hallo-image-insert-edit",{options:{editable:null,toolbar:null,uuid:"",insert_file_dialog_ui_url:null,lang:"en",dialogOpts:{autoOpen:false,width:560,height:"auto",modal:false,resizable:true,draggable:true,dialogClass:"insert-image-dialog"},dialog:null,buttonCssClass:null},translations:{en:{title_insert:"Insert Image",title_properties:"Image Properties",insert:"Insert",chage_image:"Change Image:",source:"URL",width:"Width",height:"Height",alt:"Alt Text",padding:"Padding","float":"Float",float_left:"left",float_right:"right",float_none:"No"},de:{title_insert:"Bild einfügen",title_properties:"Bildeigenschaften",insert:"Einfügen",chage_image:"Bild ändern:",source:"URL",width:"Breite",height:"Höhe",alt:"Alt Text",padding:"Padding","float":"Float",float_left:"Links",float_right:"Rechts",float_none:"Nein"}},texts:null,dialog_image_selection_ui_loaded:false,$image:null,populateToolbar:function(t){var n,r,i,s;s=this;this.texts=this.translations[this.options.lang];this.options.toolbar=t;i="<div id='hallo_img_properties'></div>";if(this.options.insert_file_dialog_ui_url){i+="<div id='hallo_img_file_select_ui'></div>"}this.options.dialog=e("<div>").attr("id",""+this.options.uuid+"-insert-image-dialog").html(i);r=e("<span>").addClass(this.widgetName);n=e("<span>");n.hallobutton({label:this.texts.title_insert,icon:"icon-picture",editable:this.options.editable,command:null,queryState:false,uuid:this.options.uuid,cssClass:this.options.buttonCssClass});r.append(n);this.button=n;this.button.click(function(){if(s.options.dialog.dialog("isOpen")){s._closeDialog()}else{s.lastSelection=s.options.editable.getSelection();s._openDialog()}return false});this.options.editable.element.on("halloselected, hallounselected",function(){if(s.options.dialog.dialog("isOpen")){return s.lastSelection=s.options.editable.getSelection()}});this.options.editable.element.on("hallodeactivated",function(){return s._closeDialog()});e(this.options.editable.element).on("click","img",function(t){s._openDialog(e(this));return false});this.options.editable.element.on("halloselected",function(n,r){var i;i=s.options.editable.options.toolbar;if(i==="halloToolbarContextual"&&e(r.originalEvent.target).is("img")){t.hide();return false}});t.append(r);return this.options.dialog.dialog(this.options.dialogOpts)},_openDialog:function(t){var n,r,i,s,o=this;this.$image=t;r=this;n=e(this.options.editable.element);i=n.offset().left+n.outerWidth()+10;if(this.$image){s=this.$image.offset().top-e(document).scrollTop()}else{s=this.options.toolbar.offset().top-e(document).scrollTop()}this.options.dialog.dialog("option","position",[i,s]);this.options.editable.keepActivated(true);this.options.dialog.dialog("open");if(this.$image){this.options.dialog.dialog("option","title",this.texts.title_properties);e(document).keyup(function(t){if(t.keyCode===46||t.keyCode===8){e(document).off();r._closeDialog();r.$image.remove();r.$image=null}return t.preventDefault()});this.options.editable.element.on("click",function(){r.$image=null;return r._closeDialog()})}else{this.options.dialog.children("#hallo_img_properties").hide();this.options.dialog.dialog("option","title",this.texts.title_insert);if(e("#hallo_img_file_select_title").length>0){e("#hallo_img_file_select_title").text("")}}this._load_dialog_image_properties_ui();this.options.dialog.on("dialogclose",function(){var t;e("label",o.button).removeClass("ui-state-active");t=e(document).scrollTop();o.options.editable.element.focus();e(document).scrollTop(t);return o.options.editable.keepActivated(false)});if(this.options.insert_file_dialog_ui_url&&!this.dialog_image_selection_ui_loaded){this.options.dialog.on("click",".reload_link",function(){r._load_dialog_image_selection_ui();return false});this.options.dialog.on("click",".file_preview img",function(){var t;if(r.$image){t=e(this).attr("src").replace(/-thumb/,"");r.$image.attr("src",t);e("#hallo_img_source").val(t)}else{r._insert_image(e(this).attr("src").replace(/-thumb/,""))}return false});return this._load_dialog_image_selection_ui()}},_insert_image:function(e){this.options.editable.restoreSelection(this.lastSelection);document.execCommand("insertImage",null,e);this.options.editable.element.trigger("change");this.options.editable.removeAllSelections();return this._closeDialog()},_closeDialog:function(){return this.options.dialog.dialog("close")},_load_dialog_image_selection_ui:function(){var t;t=this;return e.ajax({url:this.options.insert_file_dialog_ui_url,success:function(e,n,r){var i,s,o;s="";i=t.options.dialog.children("#hallo_img_properties");if(i.is(":visible")){s=t.texts.change_image}o="<div id='hallo_img_file_select_title'>"+s+"</div>";t.options.dialog.children("#hallo_img_file_select_ui").html(o+e);return t.dialog_image_selection_ui_loaded=true},beforeSend:function(){return t.options.dialog.children("#hallo_img_file_select_ui").html('<div class="hallo_insert_file_loader"></div>')}})},_load_dialog_image_properties_ui:function(){var t,n,r,i,s,o;s=this;t=this.options.dialog.children("#hallo_img_properties");if(this.$image){o=this.$image.is("[width]")?this.$image.attr("width"):"";r=this.$image.is("[height]")?this.$image.attr("height"):"";i=this._property_input_html("source",this.$image.attr("src"),{label:this.texts.source})+this._property_input_html("alt",this.$image.attr("alt")||"",{label:this.texts.alt})+this._property_row_html(this._property_input_html("width",o,{label:this.texts.width,row:false})+this._property_input_html("height",r,{label:this.texts.height,row:false}))+this._property_input_html("padding",this.$image.css("padding"),{label:this.texts.padding})+this._property_row_html(this._property_cb_html("float_left",this.$image.css("float")==="left",{label:this.texts.float_left,row:false})+this._property_cb_html("float_right",this.$image.css("float")==="right",{label:this.texts.float_right,row:false})+this._property_cb_html("unfloat",this.$image.css("float")==="none",{label:this.texts.float_none,row:false}),this.texts[float]);t.html(i);t.show()}else{if(!this.options.insert_file_dialog_ui_url){t.html(this._property_input_html("source","",{label:this.texts.source}));t.show()}}if(this.$image){if(!this.options.insert_file_dialog_ui_url){e("#insert_image_btn").remove()}if(e("#hallo_img_file_select_title").length>0){e("#hallo_img_file_select_title").text(this.texts.chage_image)}e("#hallo_img_properties #hallo_img_source").keyup(function(){return s.$image.attr("src",this.value)});e("#hallo_img_properties #hallo_img_alt").keyup(function(){return s.$image.attr("alt",this.value)});e("#hallo_img_properties #hallo_img_padding").keyup(function(){return s.$image.css("padding",this.value)});e("#hallo_img_properties #hallo_img_height").keyup(function(){s.$image.css("height",this.value);return s.$image.attr("height",this.value)});e("#hallo_img_properties #hallo_img_width").keyup(function(){s.$image.css("width",this.value);return s.$image.attr("width",this.value)});e("#hallo_img_properties #hallo_img_float_left").click(function(){if(!this.checked){return false}s.$image.css("float","left");e("#hallo_img_properties #hallo_img_float_right").removeAttr("checked");return e("#hallo_img_properties #hallo_img_unfloat").removeAttr("checked")});e("#hallo_img_properties #hallo_img_float_right").click(function(){if(!this.checked){return false}s.$image.css("float","right");e("#hallo_img_properties #hallo_img_unfloat").removeAttr("checked");return e("#hallo_img_properties #hallo_img_float_left").removeAttr("checked")});return e("#hallo_img_properties #hallo_img_unfloat").click(function(){if(!this.checked){return false}s.$image.css("float","none");e("#hallo_img_properties #hallo_img_float_right").removeAttr("checked");return e("#hallo_img_properties #hallo_img_float_left").removeAttr("checked")})}else{if(!this.options.insert_file_dialog_ui_url){n='<button id="insert_image_btn">'+this.texts.insert+"</button>";t.after(n);return e("#insert_image_btn").click(function(){var t;t=e("#hallo_img_properties #hallo_img_source");return s._insert_image(t.val())})}}},_property_col_html:function(e){return"<div class='hallo_img_property_col'>"+e+"</div>"},_property_row_html:function(e,t){if(t==null){t=""}e=this._property_col_html(t)+this._property_col_html(e);return"<div class='hallo_img_property_row'>"+e+"</div>"},_property_html:function(e,t){var n;if(t==null){t={}}if(t.row===false){if(t.label){n=""+t.label+" "+e;e="<span class='img_property_entry'>"+n+"</span>"}return e}else{n="<span class='img_property_entry'>"+e+"</span>";return this._property_row_html(n,t.label)}},_property_input_html:function(e,t,n){var r;if(n==null){n={}}r="<input type='text' id='hallo_img_"+e+"' value='"+t+"'>";return this._property_html(r,n)},_property_cb_html:function(e,t,n){var r,i;if(n==null){n={}}i=t?"checked=checked":"";r="<input type='checkbox' id='hallo_img_"+e+"' "+i+"'>";return this._property_html(r,n)}})})(jQuery);(function(e){return e.widget("IKS.halloindicator",{options:{editable:null,className:"halloEditIndicator"},_create:function(){var e=this;return this.element.on("halloenabled",function(){return e.buildIndicator()})},populateToolbar:function(){},buildIndicator:function(){var t;t=e('<div><i class="icon-edit"></i> Edit</div>');t.addClass(this.options.className);t.hide();this.element.before(t);this.bindIndicator(t);return this.setIndicatorPosition(t)},bindIndicator:function(t){var n=this;t.on("click",function(){return n.options.editable.element.focus()});this.element.on("halloactivated",function(){return t.hide()});this.element.on("hallodisabled",function(){return t.remove()});return this.options.editable.element.hover(function(){if(e(this).hasClass("inEditMode")){return}return t.show()},function(n){if(e(this).hasClass("inEditMode")){return}if(n.relatedTarget===t.get(0)){return}return t.hide()})},setIndicatorPosition:function(e){var t;e.css("position","absolute");t=this.element.position();e.css("top",t.top+2);return e.css("left",t.left+2)}})})(jQuery);(function(e){return e.widget("IKS.hallojustify",{options:{editable:null,toolbar:null,uuid:"",buttonCssClass:null},populateToolbar:function(t){var n,r,i=this;r=e('<span class="'+this.widgetName+'"></span>');n=function(t){var n;n=e("<span></span>");n.hallobutton({uuid:i.options.uuid,editable:i.options.editable,label:t,command:"justify"+t,icon:"icon-align-"+t.toLowerCase(),cssClass:i.options.buttonCssClass});return r.append(n)};n("Left");n("Center");n("Right");r.hallobuttonset();return t.append(r)}})})(jQuery);(function(e){return e.widget("IKS.hallolink",{options:{editable:null,uuid:"",link:true,image:true,defaultUrl:"http://",dialogOpts:{autoOpen:false,width:540,height:200,title:"Enter Link",buttonTitle:"Insert",buttonUpdateTitle:"Update",modal:true,resizable:false,draggable:false,dialogClass:"hallolink-dialog"},buttonCssClass:null},populateToolbar:function(t){var n,r,i,s,o,u,a,f,l,c,h=this;c=this;u=""+this.options.uuid+"-dialog";n=this.options.dialogOpts.buttonTitle;r=this.options.dialogOpts.buttonUpdateTitle;o=e('<div id="'+u+'">        <form action="#" method="post" class="linkForm">          <input class="url" type="text" name="url"            value="'+this.options.defaultUrl+'" />          <input type="submit" id="addlinkButton" value="'+n+'"/>        </form></div>');l=e("input[name=url]",o);f=function(e){if((new RegExp(/^\s*$/)).test(e)){return true}if(e===c.options.defaultUrl){return true}return false};a=function(t){var n,r;t.preventDefault();n=l.val();o.dialog("close");c.options.editable.restoreSelection(c.lastSelection);if(f(n)){document.execCommand("unlink",null,"")}else{if(!/:\/\//.test(n)&&!/^mailto:/.test(n)){n="http://"+n}if(c.lastSelection.startContainer.parentNode.href===void 0){if(c.lastSelection.collapsed){r=e("<a href='"+n+"'>"+n+"</a>")[0];c.lastSelection.insertNode(r)}else{document.execCommand("createLink",null,n)}}else{c.lastSelection.startContainer.parentNode.href=n}}c.options.editable.element.trigger("change");return false};o.find("input[type=submit]").click(a);s=e('<span class="'+c.widgetName+'"></span>');i=function(t){var i,u,a;a=""+h.options.uuid+"-"+t;u=e("<span></span>");u.hallobutton({label:"Link",icon:"icon-link",editable:h.options.editable,command:null,queryState:false,uuid:h.options.uuid,cssClass:h.options.buttonCssClass});s.append(u);i=u;i.on("click",function(t){var i,s;c.lastSelection=c.options.editable.getSelection();l=e("input[name=url]",o);s=c.lastSelection.startContainer.parentNode;if(!s.href){l.val(c.options.defaultUrl);e(l[0].form).find("input[type=submit]").val(n)}else{l.val(e(s).attr("href"));i="input[type=submit]";e(l[0].form).find(i).val(r)}c.options.editable.keepActivated(true);o.dialog("open");o.on("dialogclose",function(){c.options.editable.restoreSelection(c.lastSelection);e("label",u).removeClass("ui-state-active");c.options.editable.element.focus();return c.options.editable.keepActivated(false)});return false});return h.element.on("keyup paste change mouseup",function(t){var n,r;r=e(c.options.editable.getSelection().startContainer);if(r.prop("nodeName")){n=r.prop("nodeName")}else{n=r.parent().prop("nodeName")}if(n&&n.toUpperCase()==="A"){e("label",i).addClass("ui-state-active");return}return e("label",i).removeClass("ui-state-active")})};if(this.options.link){i("A")}if(this.options.link){t.append(s);s.hallobuttonset();return o.dialog(this.options.dialogOpts)}}})})(jQuery);(function(e){return e.widget("IKS.hallolists",{options:{editable:null,toolbar:null,uuid:"",lists:{ordered:true,unordered:true},buttonCssClass:null},populateToolbar:function(t){var n,r,i=this;r=e('<span class="'+this.widgetName+'"></span>');n=function(t,n){var s;s=e("<span></span>");s.hallobutton({uuid:i.options.uuid,editable:i.options.editable,label:n,command:"insert"+t+"List",icon:"icon-list-"+n.toLowerCase(),cssClass:i.options.buttonCssClass});return r.append(s)};if(this.options.lists.ordered){n("Ordered","OL")}if(this.options.lists.unordered){n("Unordered","UL")}r.hallobuttonset();return t.append(r)}})})(jQuery);(function(e){return e.widget("IKS.hallooverlay",{options:{editable:null,toolbar:null,uuid:"",overlay:null,padding:10,background:null},_create:function(){var t;t=this;if(!this.options.bound){this.options.bound=true;this.options.editable.element.on("halloactivated",function(n,r){t.options.currentEditable=e(n.target);if(!t.options.visible){return t.showOverlay()}});this.options.editable.element.on("hallomodified",function(n,r){t.options.currentEditable=e(n.target);if(t.options.visible){return t.resizeOverlay()}});return this.options.editable.element.on("hallodeactivated",function(n,r){t.options.currentEditable=e(n.target);if(t.options.visible){return t.hideOverlay()}})}},showOverlay:function(){this.options.visible=true;if(this.options.overlay===null){if(e("#halloOverlay").length>0){this.options.overlay=e("#halloOverlay")}else{this.options.overlay=e('<div id="halloOverlay"            class="halloOverlay">');e(document.body).append(this.options.overlay)}this.options.overlay.on("click",e.proxy(this.options.editable.turnOff,this.options.editable))}this.options.overlay.show();if(this.options.background===null){if(e("#halloBackground").length>0){this.options.background=e("#halloBackground")}else{this.options.background=e('<div id="halloBackground"            class="halloBackground">');e(document.body).append(this.options.background)}}this.resizeOverlay();this.options.background.show();if(!this.options.originalZIndex){this.options.originalZIndex=this.options.currentEditable.css("z-index")}return this.options.currentEditable.css("z-index","350")},resizeOverlay:function(){var e;e=this.options.currentEditable.offset();return this.options.background.css({top:e.top-this.options.padding,left:e.left-this.options.padding,width:this.options.currentEditable.width()+2*this.options.padding,height:this.options.currentEditable.height()+2*this.options.padding})},hideOverlay:function(){this.options.visible=false;this.options.overlay.hide();this.options.background.hide();return this.options.currentEditable.css("z-index",this.options.originalZIndex)},_findBackgroundColor:function(e){var t;t=e.css("background-color");if(t!=="rgba(0, 0, 0, 0)"&&t!=="transparent"){return t}if(e.is("body")){return"white"}else{return this._findBackgroundColor(e.parent())}}})})(jQuery);(function(e){return e.widget("IKS.halloreundo",{options:{editable:null,toolbar:null,uuid:"",buttonCssClass:null},populateToolbar:function(t){var n,r,i=this;r=e('<span class="'+this.widgetName+'"></span>');n=function(t,n){var s;s=e("<span></span>");s.hallobutton({uuid:i.options.uuid,editable:i.options.editable,label:n,icon:t==="undo"?"icon-undo":"icon-repeat",command:t,queryState:false,cssClass:i.options.buttonCssClass});return r.append(s)};n("undo","Undo");n("redo","Redo");r.hallobuttonset();return t.append(r)}})})(jQuery);(function(e){return e.widget("IKS.hallotoolbarlinebreak",{options:{editable:null,uuid:"",breakAfter:[]},populateToolbar:function(t){var n,r,i,s,o,u,a,f,l,c,h;i=e(".ui-buttonset",t);s=e();u=0;h=this.options.breakAfter;for(a=0,l=h.length;a<l;a++){o=h[a];u++;n='<div          class="halloButtonrow halloButtonrow-'+u+'" />';for(f=0,c=i.length;f<c;f++){r=i[f];s=e(s).add(e(r));if(e(r).hasClass(o)){s.wrapAll(n);i=i.not(s);s=e();break}}}if(i.length>0){u++;n='<div          class="halloButtonrow halloButtonrow-'+u+'" />';return i.wrapAll(n)}}})})(jQuery);(function(e){return e.widget("IKS.halloToolbarContextual",{toolbar:null,options:{parentElement:"body",editable:null,toolbar:null,positionAbove:false},_create:function(){var t=this;this.toolbar=this.options.toolbar;e(this.options.parentElement).append(this.toolbar);this._bindEvents();return e(window).resize(function(e){return t._updatePosition(t._getPosition(e))})},_getPosition:function(e,t){var n,r;if(!e){return}n=e.type;switch(n){case"keydown":case"keyup":case"keypress":return this._getCaretPosition(t);case"click":case"mousedown":case"mouseup":return r={top:e.pageY,left:e.pageX}}},_getCaretPosition:function(t){var n,r,i;i=e("<span/>");n=rangy.createRange();n.setStart(t.endContainer,t.endOffset);n.insertNode(i.get(0));r={top:i.offset().top,left:i.offset().left};i.remove();return r},setPosition:function(){if(this.options.parentElement!=="body"){this.options.parentElement="body";e(this.options.parentElement).append(this.toolbar)}this.toolbar.css("position","absolute");this.toolbar.css("top",this.element.offset().top-20);return this.toolbar.css("left",this.element.offset().left)},_updatePosition:function(t,n){var r,i,s,o,u;if(n==null){n=null}if(!t){return}if(!(t.top&&t.left)){return}s=this.toolbar.outerHeight()+10;if(n&&!n.collapsed&&n.nativeRange){i=n.nativeRange.getBoundingClientRect();if(this.options.positionAbove){u=i.top-s}else{u=i.bottom+10}o=e(window).scrollTop()+u;r=e(window).scrollLeft()+i.left}else{if(this.options.positionAbove){u=-10-s}else{u=20}o=t.top+u;r=t.left-this.toolbar.outerWidth()/2+30}this.toolbar.css("top",o);return this.toolbar.css("left",r)},_bindEvents:function(){var e=this;this.element.on("click",function(t,n){var r,i;r={};i=$("window").scrollTop();r.top=t.clientY+i;r.left=t.clientX;e._updatePosition(r,null);if(e.toolbar.html()!==""){return e.toolbar.show()}});this.element.on("halloselected",function(t,n){var r;r=e._getPosition(n.originalEvent,n.selection);if(!r){return}e._updatePosition(r,n.selection);if(e.toolbar.html()!==""){return e.toolbar.show()}});this.element.on("hallounselected",function(t,n){return e.toolbar.hide()});return this.element.on("hallodeactivated",function(t,n){return e.toolbar.hide()})}})})(jQuery);(function(e){return e.widget("IKS.halloToolbarFixed",{toolbar:null,options:{parentElement:"body",editable:null,toolbar:null,affix:true,affixTopOffset:2},_create:function(){var t,n,r=this;this.toolbar=this.options.toolbar;this.toolbar.show();e(this.options.parentElement).append(this.toolbar);this._bindEvents();e(window).resize(function(e){return r.setPosition()});e(window).scroll(function(e){return r.setPosition()});if(this.options.parentElement==="body"){t=e(this.element);n=parseFloat(t.css("padding-left"));n+=parseFloat(t.css("padding-right"));n+=parseFloat(t.css("border-left-width"));n+=parseFloat(t.css("border-right-width"));n+=parseFloat(t.css("outline-width"))*2;n+=parseFloat(t.css("outline-offset"))*2;return e(this.toolbar).css("width",t.width()+n)}},_getPosition:function(e,t){var n,r,i;if(!e){return}i=parseFloat(this.element.css("outline-width"));n=i+parseFloat(this.element.css("outline-offset"));return r={top:this.element.offset().top-this.toolbar.outerHeight()-n,left:this.element.offset().left-n}},_getCaretPosition:function(t){var n,r,i;i=e("<span/>");n=rangy.createRange();n.setStart(t.endContainer,t.endOffset);n.insertNode(i.get(0));r={top:i.offset().top,left:i.offset().left};i.remove();return r},setPosition:function(){var t,n,r,i,s,o;if(this.options.parentElement!=="body"){return}this.toolbar.css("position","absolute");this.toolbar.css("top",this.element.offset().top-this.toolbar.outerHeight());if(this.options.affix){s=e(window).scrollTop();i=this.element.offset();r=this.element.height();o=this.options.affixTopOffset;n=i.top-(this.toolbar.height()+this.options.affixTopOffset);t=r-o+(i.top-this.toolbar.height());if(s>n&&s<t){this.toolbar.css("position","fixed");this.toolbar.css("top",this.options.affixTopOffset)}}else{}return this.toolbar.css("left",this.element.offset().left-2)},_updatePosition:function(e){},_bindEvents:function(){var e=this;this.element.on("halloactivated",function(t,n){e.setPosition();return e.toolbar.show()});return this.element.on("hallodeactivated",function(t,n){return e.toolbar.hide()})}})})(jQuery);(function(e){return e.widget("IKS.halloToolbarInstant",{toolbar:null,options:{parentElement:"body",editable:null,toolbar:null,positionAbove:false},_create:function(){var t=this;this.toolbar=this.options.toolbar;e(this.options.parentElement).append(this.toolbar);this._bindEvents();return e(window).resize(function(e){return t._updatePosition(t._getPosition(e))})},_getPosition:function(e,t){var n,r;if(!e){return}n=e.type;switch(n){case"keydown":case"keyup":case"keypress":return this._getCaretPosition(t);case"click":case"mousedown":case"mouseup":return r={top:e.pageY,left:e.pageX}}},_getCaretPosition:function(t){var n,r,i;i=e("<span/>");n=rangy.createRange();n.setStart(t.endContainer,t.endOffset);n.insertNode(i.get(0));r={top:i.offset().top,left:i.offset().left};i.remove();return r},setPosition:function(){if(this.options.parentElement!=="body"){this.options.parentElement="body";e(this.options.parentElement).append(this.toolbar)}this.toolbar.css("position","absolute");this.toolbar.css("top",this.element.offset().top-20);return this.toolbar.css("left",this.element.offset().left)},_updatePosition:function(t,n){var r,i,s,o,u;if(n==null){n=null}if(!t){return}if(!(t.top&&t.left)){return}s=this.toolbar.outerHeight()+10;if(n&&!n.collapsed&&n.nativeRange){i=n.nativeRange.getBoundingClientRect();if(this.options.positionAbove){u=i.top-s}else{u=i.bottom+10}o=e(window).scrollTop()+u;r=e(window).scrollLeft()+i.left}else{if(this.options.positionAbove){u=-10-s}else{u=20}o=t.top+u;r=t.left-this.toolbar.outerWidth()/2+30}this.toolbar.css("top",o);return this.toolbar.css("left",r)},_bindEvents:function(){var e=this;this.element.on("click",function(t,n){var r,i;r={};i=$("window").scrollTop();r.top=t.clientY+i;r.left=t.clientX;e._updatePosition(r,null);if(e.toolbar.html()!==""){return e.toolbar.show()}});this.element.on("halloselected",function(t,n){var r;r=e._getPosition(n.originalEvent,n.selection);if(!r){return}e._updatePosition(r,n.selection);if(e.toolbar.html()!==""){return e.toolbar.show()}});this.element.on("hallounselected",function(t,n){return e.toolbar.hide()});return this.element.on("hallodeactivated",function(t,n){return e.toolbar.hide()})}})})(jQuery);(function(e){e.widget("IKS.hallobutton",{button:null,isChecked:false,options:{uuid:"",label:null,icon:null,editable:null,command:null,commandValue:null,queryState:true,cssClass:null},_create:function(){var e,t,n,r,i,s=this;if((i=(r=this.options).icon)==null){r.icon="icon-"+this.options.label.toLowerCase()}t=""+this.options.uuid+"-"+this.options.label;n=this.options;this.button=this._createButton(t,n.command,n.label,n.icon);this.element.append(this.button);if(this.options.cssClass){this.button.addClass(this.options.cssClass)}if(this.options.editable.options.touchScreen){this.button.addClass("btn-large")}this.button.data("hallo-command",this.options.command);if(this.options.commandValue){this.button.data("hallo-command-value",this.options.commandValue)}e="ui-state-hover";this.button.on("mouseenter",function(t){if(s.isEnabled()){return s.button.addClass(e)}});return this.button.on("mouseleave",function(t){return s.button.removeClass(e)})},_init:function(){var e,t,n,r=this;if(!this.button){this.button=this._prepareButton()}this.element.append(this.button);if(this.options.queryState===true){n=function(e){var t,n;if(!r.options.command){return}try{if(r.options.commandValue){n=document.queryCommandValue(r.options.command);t=n.match(new RegExp(r.options.commandValue,"i"));return r.checked(t?true:false)}else{return r.checked(document.queryCommandState(r.options.command))}}catch(i){}}}else{n=this.options.queryState}if(this.options.command){this.button.on("click",function(e){if(r.options.commandValue){r.options.editable.execute(r.options.command,r.options.commandValue)}else{r.options.editable.execute(r.options.command)}if(typeof n==="function"){n()}return false})}if(!this.options.queryState){return}e=this.options.editable.element;t="keyup paste change mouseup hallomodified";e.on(t,n);e.on("halloenabled",function(){return e.on(t,n)});return e.on("hallodisabled",function(){return e.off(t,n)})},enable:function(){return this.button.removeAttr("disabled")},disable:function(){return this.button.attr("disabled","true")},isEnabled:function(){return this.button.attr("disabled")!=="true"},refresh:function(){if(this.isChecked){return this.button.addClass("ui-state-active")}else{return this.button.removeClass("ui-state-active")}},checked:function(e){this.isChecked=e;return this.refresh()},_createButton:function(t,n,r,i){var s;s=["ui-button","ui-widget","ui-state-default","ui-corner-all","ui-button-text-only",""+n+"_button"];return e('<button id="'+t+'"        class="'+s.join(" ")+'" title="'+r+'">          <span class="ui-button-text">            <i class="'+i+'"></i>          </span>        </button>')}});return e.widget("IKS.hallobuttonset",{buttons:null,_create:function(){return this.element.addClass("ui-buttonset")},_init:function(){return this.refresh()},refresh:function(){var e;e=this.element.css("direction")==="rtl";this.buttons=this.element.find(".ui-button");this.buttons.removeClass("ui-corner-all ui-corner-left ui-corner-right");if(e){this.buttons.filter(":first").addClass("ui-corner-right");return this.buttons.filter(":last").addClass("ui-corner-left")}else{this.buttons.filter(":first").addClass("ui-corner-left");return this.buttons.filter(":last").addClass("ui-corner-right")}}})})(jQuery);(function(e){return e.widget("IKS.hallodropdownbutton",{button:null,options:{uuid:"",label:null,icon:null,editable:null,target:"",cssClass:null},_create:function(){var e,t;return(t=(e=this.options).icon)!=null?t:e.icon="icon-"+this.options.label.toLowerCase()},_init:function(){var t,n=this;t=e(this.options.target);t.css("position","absolute");t.addClass("dropdown-menu");t.hide();if(!this.button){this.button=this._prepareButton()}this.button.on("click",function(){if(t.hasClass("open")){n._hideTarget();return}return n._showTarget()});t.on("click",function(){return n._hideTarget()});this.options.editable.element.on("hallodeactivated",function(){return n._hideTarget()});return this.element.append(this.button)},_showTarget:function(){var t;t=e(this.options.target);this._updateTargetPosition();t.addClass("open");return t.show()},_hideTarget:function(){var t;t=e(this.options.target);t.removeClass("open");return t.hide()},_updateTargetPosition:function(){var t,n,r,i;n=e(this.options.target);i=this.button.position(),r=i.top,t=i.left;r+=this.button.outerHeight();n.css("top",r);return n.css("left",t-20)},_prepareButton:function(){var t,n,r;r=""+this.options.uuid+"-"+this.options.label;n=["ui-button","ui-widget","ui-state-default","ui-corner-all","ui-button-text-only"];t=e('<button id="'+r+'"       class="'+n.join(" ")+'" title="'+this.options.label+'">       <span class="ui-button-text"><i class="'+this.options.icon+'"></i></span>       </button>');if(this.options.cssClass){t.addClass(this.options.cssClass)}return t}})})(jQuery)}).call(this)
